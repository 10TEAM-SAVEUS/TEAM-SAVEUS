"use client";
import Footer from "@/components/common/Footer";
import Header from "@/components/common/Header";
import Image from "next/image";
import emptyPin from "../../../assets/emptyPin.svg";
import shareFat from "../../../assets/shareFat.svg";
import { Inter } from "next/font/google";
import { db } from "../../../firebase/setting"; // Firestore import
import { doc, getDoc } from "firebase/firestore";
import { useRouter } from "next/navigation"; // next/navigation의 useRouter 사용
import { useParams } from "next/navigation"; // useParams 사용
import { useEffect, useState } from "react";
import ChatBotContainer from "@/components/ChatBot/ChatBotContainer";

const inter = Inter({
  subsets: ["latin"],
  weight: ["400", "500", "700"],
});

export default function DetailPage() {
  const router = useRouter();
  const params = useParams();
  // 코드수정
  const { id } = params as { id: string };
  const [report, setReport] = useState<any>(null);

  useEffect(() => {
    const fetchReport = async () => {
      if (id) {
        const docRef = doc(db, "Reports", id as string);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          const data = docSnap.data();
          console.log("Fetched report data:", data);
          setReport(data);
        } else {
          console.log("No such document!");
        }
      }
    };

    fetchReport();
  }, [id]);

  if (!report) {
    return <div>Loading...</div>;
  }

  return (
    <>
      <Header />
      <div className="flex flex-col items-center">
        <main className="w-[1314px] mt-[33px] flex flex-col items-center">
          <article className="w-full">
            {/* 헤더 섹션 */}
            <section className="h-[243px] border-b border-solid border-[#C3C3C3]">
              <header className="pt-7">
                <span className="flex bg-[#FF6D6D] w-[59px] h-[35px] pt-2.5 pr-3 py-2.5 pl-3 gap-2.5 rounded-full items-center text-white text-[16px] font-semibold mr-2">
                  HOT
                </span>
                <h1 className="pt-5 font-medium text-4xl leading-[44px]">
                  {report.Title}
                </h1>
                <div className="flex justify-between pt-8">
                  <div className="flex">
                    <h2 className="pr-9 text-xl text-[#969696] font-normal">
                      취약성 뉴스 세부정보
                    </h2>
                    <time className="text-xl text-[#969696] font-normal">
                      출시시간 |{" "}
                      {new Date(
                        report.ReleaseDate.seconds * 1000
                      ).toLocaleString()}
                    </time>
                  </div>

                  <div className="flex items-center">
                    <button className="pr-6">
                      <Image
                        src={emptyPin}
                        alt="고정 핀 제거 상태"
                        width={28}
                        height={28}
                      />
                    </button>
                    <button>
                      <Image
                        src={shareFat}
                        alt="공유하기 이모티콘"
                        width={32}
                        height={32}
                      />
                    </button>
                  </div>
                </div>
              </header>
            </section>

            {/* 본문 섹션 */}
            <div className="w-[1314px] h-[924px] mb-[60px] border-b border-solid border-[#C3C3C3]">
              <section className="w-[1284px] h-[864px] pt-[60px] pl-[15px] text-2xl font-normal">
                <p>{report.MainContent}</p>
              </section>
            </div>

            {/* 표 섹션: SubContent가 있을 때만 렌더링 */}
            {report.SubContent && (
              <section className="w-[1314px] h-[1422px] pt-[60px] pl-14 pr-14 border border-solid border-[#C3C3C3] rounded-[20px]">
                {report.SubContent}
              </section>
            )}

            {/* 비슷한 정보글 섹션 */}
            <section className="pt-[60px]">
              <h2 className="font-semibold text-2xl">비슷한 정보글</h2>
              <ul className="pt-4 grid grid-cols-3 gap-5">
                <li className="w-[414px] h-[275px] border border-solid border-[#C3C3C3] rounded-lg mb-4">
                  <div className="pl-7 pt-7 pr-[30px]">
                    <span className="flex bg-[#FF6D6D] w-[59px] h-[35px] pt-2.5 pr-3 py-2.5 pl-3 gap-2.5 rounded-full items-center text-white text-[16px] font-semibold mr-2">
                      HOT
                    </span>
                    <p
                      className={`w-[356px] h-[72px] mt-2 gap-0 font-inter text-[24px] font-medium leading-[36px] tracking-[-0.01em] text-left overflow-hidden text-ellipsis line-clamp-2 ${inter.className}`}
                    >
                      [취약성 경고] Microsoft의 여러 보안 취약점에 대한 CNNVD의
                      보고서
                    </p>
                  </div>
                  <p className="w-[356px] h-[24px] mt-6 text-[16px] font-normal leading-[19.36px] tracking-[-0.01em] text-[#ADADAD] pl-7">
                    간략한 글 내용
                  </p>
                  <div className="flex justify-between pt-6">
                    <div className="flex pl-7">
                      <button className="pr-3">
                        <Image
                          src={emptyPin}
                          alt="고정 핀 제거 상태"
                          width={28}
                          height={28}
                        />
                      </button>
                      <button>
                        <Image
                          src={shareFat}
                          alt="즐겨찾기 버튼"
                          width={28}
                          height={28}
                        />
                      </button>
                    </div>
                    <span className="pr-7 text-base text-[#969696] font-normal">
                      2일전
                    </span>
                  </div>
                </li>
                <li className="w-[414px] h-[275px] border border-solid border-[#C3C3C3] rounded-lg mb-4">
                  <div className="pl-7 pt-7 pr-[30px]">
                    <span className="flex bg-[#6DB0FF] w-[59px] h-[35px] pt-2.5 pr-3 py-2.5 pl-3 gap-2.5 rounded-full items-center text-white text-[16px] font-semibold mr-2">
                      NEW
                    </span>
                    <p
                      className={`w-[356px] h-[72px] mt-2 gap-0 font-inter text-[24px] font-medium leading-[36px] tracking-[-0.01em] text-left overflow-hidden text-ellipsis line-clamp-2 ${inter.className}`}
                    >
                      [취약성 경고] Microsoft의 여러 보안 취약점에 대한 CNNVD의
                      보고서
                    </p>
                  </div>
                  <p className="w-[356px] h-[24px] mt-6 text-[16px] font-normal leading-[19.36px] tracking-[-0.01em] text-[#ADADAD] pl-7">
                    간략한 글 내용
                  </p>
                  <div className="flex justify-between pt-6">
                    <div className="flex pl-7">
                      <button className="pr-3">
                        <Image
                          src={emptyPin}
                          alt="고정 핀 제거 상태"
                          width={28}
                          height={28}
                        />
                      </button>
                      <button>
                        <Image
                          src={shareFat}
                          alt="즐겨찾기 버튼"
                          width={28}
                          height={28}
                        />
                      </button>
                    </div>
                    <span className="pr-7 text-base text-[#969696] font-normal">
                      2일전
                    </span>
                  </div>
                </li>
                <li className="w-[414px] h-[275px] border border-solid border-[#C3C3C3] rounded-lg mb-4">
                  <div className="pl-7 pt-7 pr-[30px]">
                    <span className="flex bg-[#FF6D6D] w-[59px] h-[35px] pt-2.5 pr-3 py-2.5 pl-3 gap-2.5 rounded-full items-center text-white text-[16px] font-semibold mr-2">
                      HOT
                    </span>
                    <p
                      className={`w-[356px] h-[72px] mt-2 gap-0 font-inter text-[24px] font-medium leading-[36px] tracking-[-0.01em] text-left overflow-hidden text-ellipsis line-clamp-2 ${inter.className}`}
                    >
                      [취약성 경고] Microsoft의 여러 보안 취약점에 대한 CNNVD의
                      보고서
                    </p>
                  </div>
                  <p className="w-[356px] h-[24px] mt-6 text-[16px] font-normal leading-[19.36px] tracking-[-0.01em] text-[#ADADAD] pl-7">
                    간략한 글 내용
                  </p>
                  <div className="flex justify-between pt-6">
                    <div className="flex pl-7">
                      <button className="pr-3">
                        <Image
                          src={emptyPin}
                          alt="고정 핀 제거 상태"
                          width={28}
                          height={28}
                        />
                      </button>
                      <button>
                        <Image
                          src={shareFat}
                          alt="즐겨찾기 버튼"
                          width={28}
                          height={28}
                        />
                      </button>
                    </div>
                    <span className="pr-7 text-base text-[#969696] font-normal">
                      2일전
                    </span>
                  </div>
                </li>
                <li className="w-[414px] h-[275px] border border-solid border-[#C3C3C3] rounded-lg mb-4">
                  <div className="pl-7 pt-7 pr-[30px]">
                    <span className="flex bg-[#FF6D6D] w-[59px] h-[35px] pt-2.5 pr-3 py-2.5 pl-3 gap-2.5 rounded-full items-center text-white text-[16px] font-semibold mr-2">
                      HOT
                    </span>
                    <p
                      className={`w-[356px] h-[72px] mt-2 gap-0 font-inter text-[24px] font-medium leading-[36px] tracking-[-0.01em] text-left overflow-hidden text-ellipsis line-clamp-2 ${inter.className}`}
                    >
                      [취약성 경고] Microsoft의 여러 보안 취약점에 대한 CNNVD의
                      보고서
                    </p>
                  </div>
                  <p className="w-[356px] h-[24px] mt-6 text-[16px] font-normal leading-[19.36px] tracking-[-0.01em] text-[#ADADAD] pl-7">
                    간략한 글 내용
                  </p>
                  <div className="flex justify-between pt-6">
                    <div className="flex pl-7">
                      <button className="pr-3">
                        <Image
                          src={emptyPin}
                          alt="고정 핀 제거 상태"
                          width={28}
                          height={28}
                        />
                      </button>
                      <button>
                        <Image
                          src={shareFat}
                          alt="즐겨찾기 버튼"
                          width={28}
                          height={28}
                        />
                      </button>
                    </div>
                    <span className="pr-7 text-base text-[#969696] font-normal">
                      2일전
                    </span>
                  </div>
                </li>
                <li className="w-[414px] h-[275px] border border-solid border-[#C3C3C3] rounded-lg mb-4">
                  <div className="pl-7 pt-7 pr-[30px]">
                    <span className="flex bg-[#6DB0FF] w-[59px] h-[35px] pt-2.5 pr-3 py-2.5 pl-3 gap-2.5 rounded-full items-center text-white text-[16px] font-semibold mr-2">
                      NEW
                    </span>
                    <p
                      className={`w-[356px] h-[72px] mt-2 gap-0 font-inter text-[24px] font-medium leading-[36px] tracking-[-0.01em] text-left overflow-hidden text-ellipsis line-clamp-2 ${inter.className}`}
                    >
                      [취약성 경고] Microsoft의 여러 보안 취약점에 대한 CNNVD의
                      보고서
                    </p>
                  </div>
                  <p className="w-[356px] h-[24px] mt-6 text-[16px] font-normal leading-[19.36px] tracking-[-0.01em] text-[#ADADAD] pl-7">
                    간략한 글 내용
                  </p>
                  <div className="flex justify-between pt-6">
                    <div className="flex pl-7">
                      <button className="pr-3">
                        <Image
                          src={emptyPin}
                          alt="고정 핀 제거 상태"
                          width={28}
                          height={28}
                        />
                      </button>
                      <button>
                        <Image
                          src={shareFat}
                          alt="즐겨찾기 버튼"
                          width={28}
                          height={28}
                        />
                      </button>
                    </div>
                    <span className="pr-7 text-base text-[#969696] font-normal">
                      2일전
                    </span>
                  </div>
                </li>
                <li className="w-[414px] h-[275px] border border-solid border-[#C3C3C3] rounded-lg mb-4">
                  <div className="pl-7 pt-7 pr-[30px]">
                    <span className="flex bg-[#6DB0FF] w-[59px] h-[35px] pt-2.5 pr-3 py-2.5 pl-3 gap-2.5 rounded-full items-center text-white text-[16px] font-semibold mr-2">
                      NEW
                    </span>
                    <p
                      className={`w-[356px] h-[72px] mt-2 gap-0 font-inter text-[24px] font-medium leading-[36px] tracking-[-0.01em] text-left overflow-hidden text-ellipsis line-clamp-2 ${inter.className}`}
                    >
                      [취약성 경고] Microsoft의 여러 보안 취약점에 대한 CNNVD의
                      보고서
                    </p>
                  </div>
                  <p className="w-[356px] h-[24px] mt-6 text-[16px] font-normal leading-[19.36px] tracking-[-0.01em] text-[#ADADAD] pl-7">
                    간략한 글 내용
                  </p>
                  <div className="flex justify-between pt-6">
                    <div className="flex pl-7">
                      <button className="pr-3">
                        <Image
                          src={emptyPin}
                          alt="고정 핀 제거 상태"
                          width={28}
                          height={28}
                        />
                      </button>
                      <button>
                        <Image
                          src={shareFat}
                          alt="즐겨찾기 버튼"
                          width={28}
                          height={28}
                        />
                      </button>
                    </div>
                    <span className="pr-7 text-base text-[#969696] font-normal">
                      2일전
                    </span>
                  </div>
                </li>
              </ul>
            </section>
          </article>
        </main>
      </div>

      <Footer />
      <div
        style={{ position: "fixed", top: "20px", left: "0px", zIndex: 1000 }}
      >
        <ChatBotContainer />
      </div>
    </>
  );
}
